"use strict";function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}angular.module("app",["ngAnimate","ngMaterial","ngMessages","ui.router"]),function(){function t(t,i,e){this.$scope=t,this.$http=i,this.config=e,this.dgConfig={width:500,height:500,radius:110,stepRadius:15},this.init()}t.$inject=["$scope","$http","configFactory"],angular.module("app").controller("mainCtrl",t),t.prototype.init=function(){var t=this;this.$http.get(this.config.fixtures+"countries.json").then(function(i){t.countries=i.data,t.cNum=0}),this.$http.get(this.config.fixtures+"otherinfo.json").then(function(i){t.info2=i.data,t.iNum=0})},t.prototype.setCountry=function(t,i){t.preventDefault(),this.cNum=i},t.prototype.setInfo2Item=function(t,i){t.preventDefault(),this.iNum=i},t.prototype.callbackClick=function(t){console.log("---=== item ===---",t)}}(),function(){angular.module("app").factory("configFactory",function(){var t={fixtures:"./src/fixtures/",components:"./src/components/"};return{fixtures:t.fixtures,components:t.components}})}(),function(){angular.module("app").factory("ngDgPresetsFactory",function(){var t=500,i=500,e={pathColors:{0:"#f58a41",1:"#f0d367",2:"#e64d1b"},svgWidth:t,svgHeight:i,svgStyles:{width:t,height:i,fill:"blue"},svgWrapStyles:{width:t+"px",height:i+"px",overflow:"hidden"},radius:155,animateTime:500,animateStep:1,sRadius:30};return{pathColors:e.pathColors,svgWidth:e.svgWidth,svgHeight:e.svgHeight,svgStyles:e.svgStyles,svgWrapStyles:e.svgWrapStyles,radius:e.radius,animateTime:e.animateTime,animateStep:e.animateStep,sRadius:e.sRadius}})}(),function(){angular.module("app").config(["$stateProvider","$urlRouterProvider",function(t,i){var e="./src/components/";i.otherwise("/");var n={main:{templateUrl:e+"main/index.html"}};t.state("home",{url:"/",views:n})}])}();var _createClass=function(){function t(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(i,e,n){return e&&t(i.prototype,e),n&&t(i,n),i}}();!function(){angular.module("app").service("ngDgService",function(){return new t});var t=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"calculateAbsCoord",value:function(t,i,e){var n=[];return t>=0&&t<90?(n[0]=i.x+Math.abs(e*+Math.sin(t*Math.PI/180).toPrecision(10)),n[1]=i.y-Math.abs(e*+Math.cos(t*Math.PI/180).toPrecision(10))):t>=90&&t<180?(n[0]=i.x+Math.abs(e*+Math.sin(t*Math.PI/180).toPrecision(10)),n[1]=i.y+Math.abs(e*+Math.cos(t*Math.PI/180).toPrecision(10))):t>=180&&t<270?(n[0]=i.x-Math.abs(e*+Math.sin(t*Math.PI/180).toPrecision(10)),n[1]=i.y+Math.abs(e*+Math.cos(t*Math.PI/180).toPrecision(10))):t>=270&&t<=360&&(n[0]=i.x-Math.abs(e*+Math.sin(t*Math.PI/180).toPrecision(10)),n[1]=i.y-Math.abs(e*+Math.cos(t*Math.PI/180).toPrecision(10))),n}},{key:"createCircles",value:function(t){for(var i=[],e=t.sRadius;e<t.width;e+=t.sRadius)i.push({center:{x:t.width/2,y:t.height/2},radius:e});return i}}]),t}()}(),function(){function t(t,i,e,n){var a=this;this.$scope=t,this.$timeout=e,this.ngDgService=n,this.pathClick||(this.pathClick=function(){console.log("Коллбек по клику не задан")}),this.prs=i,this.$scope.$watch(function(){return a.data},function(t){t&&a.init()}),this.$scope.$watchGroup([function(){return a.width},function(){return a.height},function(){return a.radius},function(){return a.stepRadius}],function(){a.init()})}t.$inject=["$scope","ngDgPresetsFactory","$timeout","ngDgService"],angular.module("app").controller("ngDiagrammCtrl",t),angular.module("app").directive("ngDiagramm",["configFactory",function(i){function e(t,i,e,n){}var n="ngDiagramm";return{link:e,scope:{},templateUrl:i.components+n+"/"+n+".html",controller:t,controllerAs:"dg",bindToController:{data:"=?",styles:"=?",width:"@?",height:"@?",radius:"@?",stepRadius:"@?",pathClickCb:"=?",ctx:"=?",name:"@?"}}}]),t.prototype.init=function(){this.pathes=[],this.circles=[];var t={width:+this.width||this.prs.svgWidth,height:+this.height||this.prs.svgHeight,radius:+this.radius||this.prs.radius,sRadius:+this.stepRadius||this.prs.sRadius,center:{x:(+this.width||this.prs.svgWidth)/2,y:(+this.height||this.prs.svgHeight)/2}};this.pathes&&this.pathes.length&&(this.pathes.length=0),this.circles=this.ngDgService.createCircles(t);var i=[],e=[];for(var n in this.data.data)i.push({value:this.data.data[n].value,text:this.data.data[n].text});for(var a=0,s=0;s<i.length;s+=1){for(var r=0,o=0;o<i.length;o+=1)i[s].value<i[o].value&&(r+=1);e.push({a1:3.6*a,a2:3.6*(a+i[s].value),text:i[s].text,value:i[s].value,sRadius:r}),a+=i[s].value}this.pathLength=e.length;for(var u=0;u<e.length;u+=1){var c={x1:"",y1:"",x2:"",y2:""},h=this.ngDgService.calculateAbsCoord(e[u].a1,t.center,t.radius-e[u].sRadius*t.sRadius);c.x1=h[0],c.y1=h[1],h=this.ngDgService.calculateAbsCoord(e[u].a2,t.center,t.radius-e[u].sRadius*t.sRadius),c.x2=h[0],c.y2=h[1];for(var l in c)c[l]=Math.round(c[l]);var g=this.ngDgService.calculateAbsCoord((e[u].a1+e[u].a2)/2,t.center,(t.radius-u*t.sRadius)/2),p={id:"g_"+(u+1),color:this.prs.pathColors[e[u].sRadius],value:e[u].value,text:e[u].text,radius:t.radius-e[u].sRadius*t.sRadius,showTooltip:!1,angle:{start:e[u].a1,end:e[u].a2},startPos:{x:c.x1,y:c.y1},endPos:{x:c.x2,y:c.y2},textPosition:{x:g[0],y:g[1]}};this.pathes.push(p),this.pathAnimation(this.pathes[u],t,u)}},t.prototype.pathAnimation=function(t,i,e){var n=this,a=t.angle.start,s=this.prs.animateTime/((t.angle.end-t.angle.start)/this.prs.animateStep);setTimeout(function(){t.showTooltip=t.angle.end-t.angle.start>15},500);var r=setTimeout(function o(){if(a>=t.angle.end)return clearTimeout(r),n.pathLength-1==e&&(n.watcherAccess=!0),!1;a+=n.prs.animateStep,a>t.angle.end&&(a=t.angle.end),t.flag=a-t.angle.start<=180?0:1;var u=n.ngDgService.calculateAbsCoord(a,i.center,t.radius);t.settings="M "+i.center.x+","+i.center.y+" L "+t.startPos.x+","+t.startPos.y+" A"+t.radius+","+t.radius+" 0 "+t.flag+", 1 "+u[0]+","+u[1],r=setTimeout(o,s),n.$scope.$digest()},s)},t.prototype.pathClick=function(t,i){t.preventDefault(),this.pathClickCb.call(this.ctx,i)}}(),function(){angular.module("app").directive("ngR",function(){return function(t,i,e){e.$observe("ngR",function(t){i.attr("r",t)})}}).directive("ngCx",function(){return function(t,i,e){e.$observe("ngCx",function(t){i.attr("cx",t)})}}).directive("ngX",function(){return function(t,i,e){e.$observe("ngX",function(t){i.attr("x",t)})}}).directive("ngY",function(){return function(t,i,e){e.$observe("ngY",function(t){i.attr("y",t)})}}).directive("ngCy",function(){return function(t,i,e){e.$observe("ngCy",function(t){i.attr("cy",t)})}}).directive("ngD",function(){return function(t,i,e){e.$observe("ngD",function(t){i.attr("d",t)})}}).directive("ngFill",function(){return function(t,i,e){e.$observe("ngFill",function(t){i.attr("fill",t)})}})}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJfY2xhc3NDYWxsQ2hlY2siLCJpbnN0YW5jZSIsIkNvbnN0cnVjdG9yIiwiVHlwZUVycm9yIiwiYW5ndWxhciIsIm1vZHVsZSIsIm1haW5DdHJsIiwiJHNjb3BlIiwiJGh0dHAiLCJjb25maWdGYWN0b3J5IiwidGhpcyIsImNvbmZpZyIsImRnQ29uZmlnIiwid2lkdGgiLCJoZWlnaHQiLCJyYWRpdXMiLCJzdGVwUmFkaXVzIiwiaW5pdCIsIiRpbmplY3QiLCJjb250cm9sbGVyIiwicHJvdG90eXBlIiwiX3RoaXMiLCJnZXQiLCJmaXh0dXJlcyIsInRoZW4iLCJyZXNwIiwiY291bnRyaWVzIiwiZGF0YSIsImNOdW0iLCJpbmZvMiIsImlOdW0iLCJzZXRDb3VudHJ5IiwiZSIsImlkeCIsInByZXZlbnREZWZhdWx0Iiwic2V0SW5mbzJJdGVtIiwiY2FsbGJhY2tDbGljayIsIml0ZW0iLCJjb25zb2xlIiwibG9nIiwiZmFjdG9yeSIsInBhdGgiLCJjb21wb25lbnRzIiwicHJlc2V0cyIsInBhdGhDb2xvcnMiLCIwIiwiMSIsIjIiLCJzdmdXaWR0aCIsInN2Z0hlaWdodCIsInN2Z1N0eWxlcyIsImZpbGwiLCJzdmdXcmFwU3R5bGVzIiwib3ZlcmZsb3ciLCJhbmltYXRlVGltZSIsImFuaW1hdGVTdGVwIiwic1JhZGl1cyIsIiRzdGF0ZVByb3ZpZGVyIiwiJHVybFJvdXRlclByb3ZpZGVyIiwicGF0aFRvQ29tcG9uZW50cyIsIm90aGVyd2lzZSIsIm1haW5WaWV3IiwibWFpbiIsInRlbXBsYXRlVXJsIiwic3RhdGUiLCJ1cmwiLCJ2aWV3cyIsIl9jcmVhdGVDbGFzcyIsImRlZmluZVByb3BlcnRpZXMiLCJ0YXJnZXQiLCJwcm9wcyIsImkiLCJsZW5ndGgiLCJkZXNjcmlwdG9yIiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJrZXkiLCJwcm90b1Byb3BzIiwic3RhdGljUHJvcHMiLCJzZXJ2aWNlIiwibmdEZ1NlcnZpY2UiLCJ2YWx1ZSIsImFuZ2xlIiwiY2VudGVyIiwiYXJyIiwieCIsIk1hdGgiLCJhYnMiLCJzaW4iLCJQSSIsInRvUHJlY2lzaW9uIiwieSIsImNvcyIsInB1c2giLCJuZ0RpYWdyYW1tQ3RybCIsIm5nRGdQcmVzZXRzRmFjdG9yeSIsIiR0aW1lb3V0IiwicGF0aENsaWNrIiwicHJzIiwiJHdhdGNoIiwiJHdhdGNoR3JvdXAiLCJkaXJlY3RpdmUiLCJuZ0RpYWdyYW1tTGluayIsIiRlbGVtZW50IiwiJGF0dHJzIiwibmdEZyIsImxpbmsiLCJzY29wZSIsImNvbnRyb2xsZXJBcyIsImJpbmRUb0NvbnRyb2xsZXIiLCJzdHlsZXMiLCJwYXRoQ2xpY2tDYiIsImN0eCIsIm5hbWUiLCJwYXRoZXMiLCJjaXJjbGVzIiwiY3JlYXRlQ2lyY2xlcyIsImFuZ2xlc0FyciIsInRleHQiLCJjIiwicHJpb3JpdHkiLCJqIiwiYTEiLCJhMiIsInBhdGhMZW5ndGgiLCJfaSIsImNvb3JkcyIsIngxIiwieTEiLCJ4MiIsInkyIiwiX2FyciIsImNhbGN1bGF0ZUFic0Nvb3JkIiwiX2tleSIsInJvdW5kIiwidGV4dENyZCIsInRlbXBsYXRlIiwiaWQiLCJjb2xvciIsInNob3dUb29sdGlwIiwic3RhcnQiLCJlbmQiLCJzdGFydFBvcyIsImVuZFBvcyIsInRleHRQb3NpdGlvbiIsInBhdGhBbmltYXRpb24iLCJfc2VsZiIsImN1cnJlbnRBbmdsZSIsInRpbWVTdGVwIiwic2V0VGltZW91dCIsInRpbWVvdXQiLCJmIiwiY2xlYXJUaW1lb3V0Iiwid2F0Y2hlckFjY2VzcyIsImZsYWciLCJjdXJyZW50Q29vcmRzIiwic2V0dGluZ3MiLCIkZGlnZXN0IiwiY2FsbCIsImVsZW0iLCJhdHRycyIsIiRvYnNlcnZlIiwiciIsImF0dHIiLCJjeCIsImN5IiwiZCJdLCJtYXBwaW5ncyI6IkFBQUEsWUF3SUEsU0FBU0EsaUJBQWdCQyxFQUFVQyxHQUFlLEtBQU1ELFlBQW9CQyxJ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Q25CLE1BQU8sVUFBVU0sRUFBT29ELEVBQU1DLEdBQzdCQSxFQUFNQyxTQUFTLE1BQU8sU0FBVXRFLEdBQy9Cb0UsRUFBS0ksS0FBSyxJQUFLeEUsUUFHZlUsVUFBVSxPQUFRLFdBQ3BCLE1BQU8sVUFBVU0sRUFBT29ELEVBQU1DLEdBQzdCQSxFQUFNQyxTQUFTLE9BQVEsU0FBVUksR0FDaENOLEVBQUtJLEtBQUssS0FBTUUsUUFHaEJoRSxVQUFVLE1BQU8sV0FDbkIsTUFBTyxVQUFVTSxFQUFPb0QsRUFBTUMsR0FDN0JBLEVBQU1DLFNBQVMsTUFBTyxTQUFVSyxHQUMvQlAsRUFBS0ksS0FBSyxJQUFLRyxRQUdmakUsVUFBVSxTQUFVLFdBQ3RCLE1BQU8sVUFBVU0sRUFBT29ELEVBQU1DLEdBQzdCQSxFQUFNQyxTQUFTLFNBQVUsU0FBVWpILEdBQ2xDK0csRUFBS0ksS0FBSyxPQUFRbkgiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyLm1vZHVsZSgnYXBwJywgWyduZ0FuaW1hdGUnLCAnbmdNYXRlcmlhbCcsICduZ01lc3NhZ2VzJywgJ3VpLnJvdXRlciddKTtcbi8vbGV0IG1haW5DdHJsID0gcmVxdWlyZSgnLi9jb250cm9sbGVycy9tYWluQ3RybCcpO1xuLy9cbi8vYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbnRyb2xsZXIoJ21haW5DdHJsJywgbWFpbkN0cmwpO1xuXCJ1c2Ugc3RyaWN0XCI7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cdG1haW5DdHJsLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkaHR0cFwiLCBcImNvbmZpZ0ZhY3RvcnlcIl07XG5cdGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb250cm9sbGVyKCdtYWluQ3RybCcsIG1haW5DdHJsKTtcblxuXHRmdW5jdGlvbiBtYWluQ3RybCgkc2NvcGUsICRodHRwLCBjb25maWdGYWN0b3J5KSB7XG5cdFx0dGhpcy4kc2NvcGUgPSAkc2NvcGU7XG5cdFx0dGhpcy4kaHR0cCA9ICRodHRwO1xuXHRcdHRoaXMuY29uZmlnID0gY29uZmlnRmFjdG9yeTtcblxuXHRcdHRoaXMuZGdDb25maWcgPSB7XG5cdFx0XHR3aWR0aDogNTAwLFxuXHRcdFx0aGVpZ2h0OiA1MDAsXG5cdFx0XHRyYWRpdXM6IDExMCxcblx0XHRcdHN0ZXBSYWRpdXM6IDE1XG5cdFx0fTtcblxuXHRcdHRoaXMuaW5pdCgpO1xuXHR9XG5cblx0bWFpbkN0cmwucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIF90aGlzID0gdGhpcztcblxuXHRcdHRoaXMuJGh0dHAuZ2V0KHRoaXMuY29uZmlnLmZpeHR1cmVzICsgJ2NvdW50cmllcy5qc29uJykudGhlbihmdW5jdGlvbiAocmVzcCkge1xuXHRcdFx0X3RoaXMuY291bnRyaWVzID0gcmVzcC5kYXRhO1xuXHRcdFx0X3RoaXMuY051bSA9IDA7XG5cdFx0fSk7XG5cblx0XHR0aGlzLiRodHRwLmdldCh0aGlzLmNvbmZpZy5maXh0dXJlcyArICdvdGhlcmluZm8uanNvbicpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcblx0XHRcdF90aGlzLmluZm8yID0gcmVzcC5kYXRhO1xuXHRcdFx0X3RoaXMuaU51bSA9IDA7XG5cdFx0fSk7XG5cdH07XG5cblx0bWFpbkN0cmwucHJvdG90eXBlLnNldENvdW50cnkgPSBmdW5jdGlvbiAoZSwgaWR4KSB7XG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdHRoaXMuY051bSA9IGlkeDtcblx0fTtcblxuXHRtYWluQ3RybC5wcm90b3R5cGUuc2V0SW5mbzJJdGVtID0gZnVuY3Rpb24gKGUsIGlkeCkge1xuXHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHR0aGlzLmlOdW0gPSBpZHg7XG5cdH07XG5cblx0bWFpbkN0cmwucHJvdG90eXBlLmNhbGxiYWNrQ2xpY2sgPSBmdW5jdGlvbiAoaXRlbSkge1xuXHRcdGNvbnNvbGUubG9nKCctLS09PT0gaXRlbSA9PT0tLS0nLCBpdGVtKTtcblx0fTtcbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cdGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5mYWN0b3J5KCdjb25maWdGYWN0b3J5JywgZnVuY3Rpb24gKCkge1xuXHRcdHZhciBwYXRoID0ge1xuXHRcdFx0Zml4dHVyZXM6ICcuL3NyYy9maXh0dXJlcy8nLFxuXHRcdFx0Y29tcG9uZW50czogJy4vc3JjL2NvbXBvbmVudHMvJ1xuXHRcdH07XG5cblx0XHRyZXR1cm4ge1xuXHRcdFx0Zml4dHVyZXM6IHBhdGguZml4dHVyZXMsXG5cdFx0XHRjb21wb25lbnRzOiBwYXRoLmNvbXBvbmVudHNcblx0XHR9O1xuXHR9KTtcbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cdGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5mYWN0b3J5KCduZ0RnUHJlc2V0c0ZhY3RvcnknLCBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIHdpZHRoID0gNTAwO1xuXHRcdHZhciBoZWlnaHQgPSA1MDA7XG5cblx0XHR2YXIgcHJlc2V0cyA9IHtcblx0XHRcdHBhdGhDb2xvcnM6IHsgMDogJyNmNThhNDEnLCAxOiAnI2YwZDM2NycsIDI6ICcjZTY0ZDFiJyB9LFxuXHRcdFx0c3ZnV2lkdGg6IHdpZHRoLFxuXHRcdFx0c3ZnSGVpZ2h0OiBoZWlnaHQsXG5cdFx0XHRzdmdTdHlsZXM6IHtcblx0XHRcdFx0J3dpZHRoJzogd2lkdGgsXG5cdFx0XHRcdCdoZWlnaHQnOiBoZWlnaHQsXG5cdFx0XHRcdCdmaWxsJzogJ2JsdWUnXG5cdFx0XHR9LFxuXHRcdFx0c3ZnV3JhcFN0eWxlczoge1xuXHRcdFx0XHQnd2lkdGgnOiB3aWR0aCArICdweCcsXG5cdFx0XHRcdCdoZWlnaHQnOiBoZWlnaHQgKyAncHgnLFxuXHRcdFx0XHQnb3ZlcmZsb3cnOiAnaGlkZGVuJ1xuXHRcdFx0fSxcblx0XHRcdHJhZGl1czogMTU1LFxuXHRcdFx0YW5pbWF0ZVRpbWU6IDUwMCxcblx0XHRcdGFuaW1hdGVTdGVwOiAxLFxuXHRcdFx0c1JhZGl1czogMzBcblx0XHR9O1xuXG5cdFx0cmV0dXJuIHtcblx0XHRcdHBhdGhDb2xvcnM6IHByZXNldHMucGF0aENvbG9ycyxcblx0XHRcdHN2Z1dpZHRoOiBwcmVzZXRzLnN2Z1dpZHRoLFxuXHRcdFx0c3ZnSGVpZ2h0OiBwcmVzZXRzLnN2Z0hlaWdodCxcblx0XHRcdHN2Z1N0eWxlczogcHJlc2V0cy5zdmdTdHlsZXMsXG5cdFx0XHRzdmdXcmFwU3R5bGVzOiBwcmVzZXRzLnN2Z1dyYXBTdHlsZXMsXG5cdFx0XHRyYWRpdXM6IHByZXNldHMucmFkaXVzLFxuXHRcdFx0YW5pbWF0ZVRpbWU6IHByZXNldHMuYW5pbWF0ZVRpbWUsXG5cdFx0XHRhbmltYXRlU3RlcDogcHJlc2V0cy5hbmltYXRlU3RlcCxcblx0XHRcdHNSYWRpdXM6IHByZXNldHMuc1JhZGl1c1xuXHRcdH07XG5cdH0pO1xufSkoKTtcblwidXNlIHN0cmljdFwiO1xuXG4oZnVuY3Rpb24gKCkge1xuXHRhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29uZmlnKFtcIiRzdGF0ZVByb3ZpZGVyXCIsIFwiJHVybFJvdXRlclByb3ZpZGVyXCIsIGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyKSB7XG5cdFx0dmFyIHBhdGhUb0NvbXBvbmVudHMgPSAnLi9zcmMvY29tcG9uZW50cy8nO1xuXG5cdFx0JHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnLycpO1xuXG5cdFx0dmFyIG1haW5WaWV3ID0ge1xuXHRcdFx0XCJtYWluXCI6IHtcblx0XHRcdFx0dGVtcGxhdGVVcmw6IHBhdGhUb0NvbXBvbmVudHMgKyAnbWFpbi9pbmRleC5odG1sJ1xuXHRcdFx0XHQvL3RlbXBsYXRlVXJsOiBjb25maWdGYWN0b3J5LmNvbXBvbmVudHMgKyAnZGlhZ3JhbW1QYWdlL2RpYWdyYW1tUGFnZS5odG1sJ1xuXHRcdFx0fVxuXHRcdH07XG5cblx0XHQkc3RhdGVQcm92aWRlci5zdGF0ZSgnaG9tZScsIHtcblx0XHRcdHVybDogJy8nLFxuXHRcdFx0dmlld3M6IG1haW5WaWV3XG5cdFx0fSk7XG5cdH1dKTtcbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbihmdW5jdGlvbiAoKSB7XG5cdGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5zZXJ2aWNlKCduZ0RnU2VydmljZScsIGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gbmV3IG5nRGdTZXJ2aWNlKCk7XG5cdH0pO1xuXG5cdHZhciBuZ0RnU2VydmljZSA9IGZ1bmN0aW9uICgpIHtcblx0XHRmdW5jdGlvbiBuZ0RnU2VydmljZSgpIHtcblx0XHRcdF9jbGFzc0NhbGxDaGVjayh0aGlzLCBuZ0RnU2VydmljZSk7XG5cdFx0fVxuXG5cdFx0LyoqXG4gICAqINCc0LXRgtC+0LQg0LLQvtC30LLRgNCw0YnQsNC10YIg0LzQsNGB0YHQuNCyINC40Lcg0LTQstGD0YUg0YfQuNGB0LXQuyAo0LrQvtC+0YDQtNC40L3QsNGC0YsgeCDQuCDRgylcbiAgICog0JrQvtC+0YDQtNC40L3QsNGC0Ysg0YDQsNGB0YHRh9C40YLRi9Cy0LDRjtGC0YHRjyDQtNC70Y8g0L7Qv9GA0LXQtNC10LvRkdC90L3QvtCz0L4g0YPQs9C70LAg0L7RgtC90L7RgdC40YLQtdC70YzQvdC+INGG0LXQvdGC0YDQsCDQtNC40LDQs9GA0LDQvNC80YsuXG4gICAqINCj0YfQuNGC0YvQstCw0LXQvCDRgNCw0LTQuNGD0YFcbiAgICovXG5cblxuXHRcdF9jcmVhdGVDbGFzcyhuZ0RnU2VydmljZSwgW3tcblx0XHRcdGtleTogJ2NhbGN1bGF0ZUFic0Nvb3JkJyxcblx0XHRcdHZhbHVlOiBmdW5jdGlvbiBjYWxjdWxhdGVBYnNDb29yZChhbmdsZSwgY2VudGVyLCByYWRpdXMpIHtcblx0XHRcdFx0dmFyIGFyciA9IFtdO1xuXHRcdFx0XHRpZiAoYW5nbGUgPj0gMCAmJiBhbmdsZSA8IDkwKSB7XG5cdFx0XHRcdFx0YXJyWzBdID0gY2VudGVyLnggKyBNYXRoLmFicyhyYWRpdXMgKiArTWF0aC5zaW4oYW5nbGUgKiBNYXRoLlBJIC8gMTgwKS50b1ByZWNpc2lvbigxMCkpO1xuXHRcdFx0XHRcdGFyclsxXSA9IGNlbnRlci55IC0gTWF0aC5hYnMocmFkaXVzICogK01hdGguY29zKGFuZ2xlICogTWF0aC5QSSAvIDE4MCkudG9QcmVjaXNpb24oMTApKTtcblx0XHRcdFx0fSBlbHNlIGlmIChhbmdsZSA+PSA5MCAmJiBhbmdsZSA8IDE4MCkge1xuXHRcdFx0XHRcdGFyclswXSA9IGNlbnRlci54ICsgTWF0aC5hYnMocmFkaXVzICogK01hdGguc2luKGFuZ2xlICogTWF0aC5QSSAvIDE4MCkudG9QcmVjaXNpb24oMTApKTtcblx0XHRcdFx0XHRhcnJbMV0gPSBjZW50ZXIueSArIE1hdGguYWJzKHJhZGl1cyAqICtNYXRoLmNvcyhhbmdsZSAqIE1hdGguUEkgLyAxODApLnRvUHJlY2lzaW9uKDEwKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoYW5nbGUgPj0gMTgwICYmIGFuZ2xlIDwgMjcwKSB7XG5cdFx0XHRcdFx0YXJyWzBdID0gY2VudGVyLnggLSBNYXRoLmFicyhyYWRpdXMgKiArTWF0aC5zaW4oYW5nbGUgKiBNYXRoLlBJIC8gMTgwKS50b1ByZWNpc2lvbigxMCkpO1xuXHRcdFx0XHRcdGFyclsxXSA9IGNlbnRlci55ICsgTWF0aC5hYnMocmFkaXVzICogK01hdGguY29zKGFuZ2xlICogTWF0aC5QSSAvIDE4MCkudG9QcmVjaXNpb24oMTApKTtcblx0XHRcdFx0fSBlbHNlIGlmIChhbmdsZSA+PSAyNzAgJiYgYW5nbGUgPD0gMzYwKSB7XG5cdFx0XHRcdFx0YXJyWzBdID0gY2VudGVyLnggLSBNYXRoLmFicyhyYWRpdXMgKiArTWF0aC5zaW4oYW5nbGUgKiBNYXRoLlBJIC8gMTgwKS50b1ByZWNpc2lvbigxMCkpO1xuXHRcdFx0XHRcdGFyclsxXSA9IGNlbnRlci55IC0gTWF0aC5hYnMocmFkaXVzICogK01hdGguY29zKGFuZ2xlICogTWF0aC5QSSAvIDE4MCkudG9QcmVjaXNpb24oMTApKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gYXJyO1xuXHRcdFx0fVxuXHRcdH0sIHtcblx0XHRcdGtleTogJ2NyZWF0ZUNpcmNsZXMnLFxuXG5cblx0XHRcdC8qKlxuICAgICog0JzQtdGC0L7QtCDQstC+0LfQstGA0LDRidCw0LXRgiDQvNCw0YHRgdC40LIg0YEg0L7QsdGK0LXQutGC0LDQvNC4LCDQutC+0YLQvtGA0YvQtSDRgdC+0LTQtdGA0LbQsNGCINC00LDQvdC90YvQtSDQviDQutC+0LvRjNGG0LDRhSAtINC60L7QvtGA0LTQuNC90LDRgtGLINGG0LXQvdGC0YDQsCDQuCDRgNCw0LTQuNGD0YFcbiAgICAqL1xuXHRcdFx0dmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZUNpcmNsZXMoY29uZmlnKSB7XG5cdFx0XHRcdHZhciBhcnIgPSBbXTsgLy8g0JzQsNGB0YHQuNCyINC60L7Qu9C10YZcblx0XHRcdFx0Zm9yICh2YXIgaSA9IGNvbmZpZy5zUmFkaXVzOyBpIDwgY29uZmlnLndpZHRoOyBpICs9IGNvbmZpZy5zUmFkaXVzKSB7XG5cdFx0XHRcdFx0YXJyLnB1c2goe1xuXHRcdFx0XHRcdFx0Y2VudGVyOiB7XG5cdFx0XHRcdFx0XHRcdHg6IGNvbmZpZy53aWR0aCAvIDIsXG5cdFx0XHRcdFx0XHRcdHk6IGNvbmZpZy5oZWlnaHQgLyAyXG5cdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0cmFkaXVzOiBpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIGFycjtcblx0XHRcdH1cblx0XHR9XSk7XG5cblx0XHRyZXR1cm4gbmdEZ1NlcnZpY2U7XG5cdH0oKTtcbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cdG5nRGlhZ3JhbW1DdHJsLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCJuZ0RnUHJlc2V0c0ZhY3RvcnlcIiwgXCIkdGltZW91dFwiLCBcIm5nRGdTZXJ2aWNlXCJdO1xuXHRhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29udHJvbGxlcignbmdEaWFncmFtbUN0cmwnLCBuZ0RpYWdyYW1tQ3RybCk7XG5cblx0YW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZSgnbmdEaWFncmFtbScsIFtcImNvbmZpZ0ZhY3RvcnlcIiwgZnVuY3Rpb24gKGNvbmZpZ0ZhY3RvcnkpIHtcblx0XHR2YXIgbmdEZyA9ICduZ0RpYWdyYW1tJztcblxuXHRcdGZ1bmN0aW9uIG5nRGlhZ3JhbW1MaW5rKCRzY29wZSwgJGVsZW1lbnQsICRhdHRycywgJHRpbWVvdXQpIHt9XG5cblx0XHRyZXR1cm4ge1xuXHRcdFx0bGluazogbmdEaWFncmFtbUxpbmssXG5cdFx0XHRzY29wZToge30sXG5cdFx0XHR0ZW1wbGF0ZVVybDogY29uZmlnRmFjdG9yeS5jb21wb25lbnRzICsgbmdEZyArICcvJyArIG5nRGcgKyAnLmh0bWwnLFxuXHRcdFx0Y29udHJvbGxlcjogbmdEaWFncmFtbUN0cmwsXG5cdFx0XHRjb250cm9sbGVyQXM6ICdkZycsXG5cdFx0XHRiaW5kVG9Db250cm9sbGVyOiB7XG5cdFx0XHRcdGRhdGE6ICc9PycsXG5cdFx0XHRcdHN0eWxlczogJz0/Jyxcblx0XHRcdFx0d2lkdGg6ICdAPycsXG5cdFx0XHRcdGhlaWdodDogJ0A/Jyxcblx0XHRcdFx0cmFkaXVzOiAnQD8nLFxuXHRcdFx0XHRzdGVwUmFkaXVzOiAnQD8nLFxuXHRcdFx0XHRwYXRoQ2xpY2tDYjogJz0/Jyxcblx0XHRcdFx0Y3R4OiAnPT8nLFxuXHRcdFx0XHRuYW1lOiAnQD8nXG5cdFx0XHR9XG5cdFx0fTtcblx0fV0pO1xuXG5cdGZ1bmN0aW9uIG5nRGlhZ3JhbW1DdHJsKCRzY29wZSwgbmdEZ1ByZXNldHNGYWN0b3J5LCAkdGltZW91dCwgbmdEZ1NlcnZpY2UpIHtcblx0XHR2YXIgX3RoaXMgPSB0aGlzO1xuXG5cdFx0dGhpcy4kc2NvcGUgPSAkc2NvcGU7XG5cdFx0dGhpcy4kdGltZW91dCA9ICR0aW1lb3V0O1xuXHRcdHRoaXMubmdEZ1NlcnZpY2UgPSBuZ0RnU2VydmljZTtcblxuXHRcdGlmICghdGhpcy5wYXRoQ2xpY2spIHRoaXMucGF0aENsaWNrID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0Y29uc29sZS5sb2coJ9Ca0L7Qu9C70LHQtdC6INC/0L4g0LrQu9C40LrRgyDQvdC1INC30LDQtNCw0L0nKTtcblx0XHR9O1xuXHRcdC8qKlxuICAgKiDQlNC10YTQvtC70YLQvdGL0LUg0L3QsNGB0YLRgNC+0LnQutC4INC00LvRjyDQtNC40YDQtdC60YLQuNCy0LrQuFxuICAgKi9cblx0XHR0aGlzLnBycyA9IG5nRGdQcmVzZXRzRmFjdG9yeTtcblxuXHRcdHRoaXMuJHNjb3BlLiR3YXRjaChmdW5jdGlvbiAoKSB7XG5cdFx0XHRyZXR1cm4gX3RoaXMuZGF0YTtcblx0XHR9LCBmdW5jdGlvbiAoZGF0YSkge1xuXHRcdFx0aWYgKGRhdGEpIF90aGlzLmluaXQoKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuJHNjb3BlLiR3YXRjaEdyb3VwKFtmdW5jdGlvbiAoKSB7XG5cdFx0XHRyZXR1cm4gX3RoaXMud2lkdGg7XG5cdFx0fSwgZnVuY3Rpb24gKCkge1xuXHRcdFx0cmV0dXJuIF90aGlzLmhlaWdodDtcblx0XHR9LCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRyZXR1cm4gX3RoaXMucmFkaXVzO1xuXHRcdH0sIGZ1bmN0aW9uICgpIHtcblx0XHRcdHJldHVybiBfdGhpcy5zdGVwUmFkaXVzO1xuXHRcdH1dLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRfdGhpcy5pbml0KCk7XG5cdFx0fSk7XG5cdH1cblxuXHQvKipcbiAgKiDQodGC0LDRgNGC0YPQtdC8XG4gICovXG5cdG5nRGlhZ3JhbW1DdHJsLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKCkge1xuXHRcdC8qKlxuICAgKiDQnNCw0YHRgdC40LIg0YLRjdCz0L4gPGc+LCDQutC+0YLQvtGA0YvQuSDRgNC10L3QtNC10YDQuNGC0YHRjyDQsiDRgtC10LzQv9C70LXQudGC0LVcbiAgICovXG5cdFx0dGhpcy5wYXRoZXMgPSBbXTtcblxuXHRcdC8qKlxuICAgKiDQnNCw0YHRgdC40LIg0YLRjdCz0L4gPGNpcmNsZT5cbiAgICovXG5cdFx0dGhpcy5jaXJjbGVzID0gW107XG5cblx0XHR2YXIgY29uZmlnID0ge1xuXHRcdFx0d2lkdGg6ICt0aGlzLndpZHRoIHx8IHRoaXMucHJzLnN2Z1dpZHRoLFxuXHRcdFx0aGVpZ2h0OiArdGhpcy5oZWlnaHQgfHwgdGhpcy5wcnMuc3ZnSGVpZ2h0LFxuXHRcdFx0cmFkaXVzOiArdGhpcy5yYWRpdXMgfHwgdGhpcy5wcnMucmFkaXVzLFxuXHRcdFx0c1JhZGl1czogK3RoaXMuc3RlcFJhZGl1cyB8fCB0aGlzLnBycy5zUmFkaXVzLFxuXHRcdFx0Y2VudGVyOiB7IHg6ICgrdGhpcy53aWR0aCB8fCB0aGlzLnBycy5zdmdXaWR0aCkgLyAyLCB5OiAoK3RoaXMuaGVpZ2h0IHx8IHRoaXMucHJzLnN2Z0hlaWdodCkgLyAyIH1cblx0XHR9O1xuXG5cdFx0Ly9UT0RPOiDQndCw0L/QuNGB0LDRgtGMINC/0YDQvtCy0LXRgNC60YMg0L3QsCDRgdGD0LzQvNGDINC/0YDQvtGG0LXQvdGC0L7QslxuXG5cdFx0aWYgKHRoaXMucGF0aGVzICYmIHRoaXMucGF0aGVzLmxlbmd0aCkgdGhpcy5wYXRoZXMubGVuZ3RoID0gMDtcblxuXHRcdHRoaXMuY2lyY2xlcyA9IHRoaXMubmdEZ1NlcnZpY2UuY3JlYXRlQ2lyY2xlcyhjb25maWcpO1xuXG5cdFx0dmFyIGFyciA9IFtdLFxuXHRcdCAgICBhbmdsZXNBcnIgPSBbXTtcblxuXHRcdGZvciAodmFyIGtleSBpbiB0aGlzLmRhdGEuZGF0YSkge1xuXHRcdFx0YXJyLnB1c2goe1xuXHRcdFx0XHR2YWx1ZTogdGhpcy5kYXRhLmRhdGFba2V5XS52YWx1ZSxcblx0XHRcdFx0dGV4dDogdGhpcy5kYXRhLmRhdGFba2V5XS50ZXh0XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHQvKipcbiAgICog0KHQvtC30LTQsNC10Lwg0YHQtdC60YLQvtGA0LAuINCf0YDQvtGG0LXQvdGC0Ysg0L/QtdGA0LXQstC+0LTQuNC8INCyINGA0LDQtNC40LDQvdGLXG4gICAqIGExIC0g0L3QsNGH0LDQu9C+INGB0LXQutGC0L7RgNCwLCDQsDIgPSDQutC+0L3QtdGGINGB0LXQutGC0L7RgNCwXG4gICAqL1xuXHRcdGZvciAodmFyIGMgPSAwLCBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkgKz0gMSkge1xuXHRcdFx0dmFyIHByaW9yaXR5ID0gMDtcblx0XHRcdGZvciAodmFyIGogPSAwOyBqIDwgYXJyLmxlbmd0aDsgaiArPSAxKSB7XG5cdFx0XHRcdGlmIChhcnJbaV0udmFsdWUgPCBhcnJbal0udmFsdWUpIHByaW9yaXR5ICs9IDE7XG5cdFx0XHR9XG5cdFx0XHRhbmdsZXNBcnIucHVzaCh7IGExOiBjICogMy42LCBhMjogKGMgKyBhcnJbaV0udmFsdWUpICogMy42LCB0ZXh0OiBhcnJbaV0udGV4dCwgdmFsdWU6IGFycltpXS52YWx1ZSwgc1JhZGl1czogcHJpb3JpdHkgfSk7IC8vINCf0LXRgNC10LLQvtC00LjQvCDQs9GA0LDQtNGD0YHRiyDQsiDQs9GA0LDQtNC40LXQvdGC0Ytcblx0XHRcdGMgKz0gYXJyW2ldLnZhbHVlO1xuXHRcdH1cblxuXHRcdHRoaXMucGF0aExlbmd0aCA9IGFuZ2xlc0Fyci5sZW5ndGg7XG5cblx0XHRmb3IgKHZhciBfaSA9IDA7IF9pIDwgYW5nbGVzQXJyLmxlbmd0aDsgX2kgKz0gMSkge1xuXHRcdFx0dmFyIGNvb3JkcyA9IHsgeDE6ICcnLCB5MTogJycsIHgyOiAnJywgeTI6ICcnIH07XG5cblx0XHRcdHZhciBfYXJyID0gdGhpcy5uZ0RnU2VydmljZS5jYWxjdWxhdGVBYnNDb29yZChhbmdsZXNBcnJbX2ldLmExLCBjb25maWcuY2VudGVyLCBjb25maWcucmFkaXVzIC0gYW5nbGVzQXJyW19pXS5zUmFkaXVzICogY29uZmlnLnNSYWRpdXMpO1xuXHRcdFx0Y29vcmRzLngxID0gX2FyclswXTtcblx0XHRcdGNvb3Jkcy55MSA9IF9hcnJbMV07XG5cblx0XHRcdF9hcnIgPSB0aGlzLm5nRGdTZXJ2aWNlLmNhbGN1bGF0ZUFic0Nvb3JkKGFuZ2xlc0FycltfaV0uYTIsIGNvbmZpZy5jZW50ZXIsIGNvbmZpZy5yYWRpdXMgLSBhbmdsZXNBcnJbX2ldLnNSYWRpdXMgKiBjb25maWcuc1JhZGl1cyk7XG5cdFx0XHRjb29yZHMueDIgPSBfYXJyWzBdO1xuXHRcdFx0Y29vcmRzLnkyID0gX2FyclsxXTtcblxuXHRcdFx0Zm9yICh2YXIgX2tleSBpbiBjb29yZHMpIHtcblx0XHRcdFx0Y29vcmRzW19rZXldID0gTWF0aC5yb3VuZChjb29yZHNbX2tleV0pO1xuXHRcdFx0fVxuXG5cdFx0XHQvKipcbiAgICAqINCh0LLQvtC50YHRgtCy0L4sINC60L7RgtC+0YDQvtC1INC60L7RgNC80LjQvCDQvdCwINCy0YzRjtGF0YMg0LTQu9GPINC+0YLRgNC40YHQvtCy0LrQuCDRgdC10LrRgtC+0YDQsFxuICAgICovXG5cdFx0XHR2YXIgdGV4dENyZCA9IHRoaXMubmdEZ1NlcnZpY2UuY2FsY3VsYXRlQWJzQ29vcmQoKGFuZ2xlc0FycltfaV0uYTEgKyBhbmdsZXNBcnJbX2ldLmEyKSAvIDIsIGNvbmZpZy5jZW50ZXIsIChjb25maWcucmFkaXVzIC0gX2kgKiBjb25maWcuc1JhZGl1cykgLyAyKTtcblxuXHRcdFx0dmFyIHRlbXBsYXRlID0ge1xuXHRcdFx0XHRpZDogJ2dfJyArIChfaSArIDEpLFxuXHRcdFx0XHRjb2xvcjogdGhpcy5wcnMucGF0aENvbG9yc1thbmdsZXNBcnJbX2ldLnNSYWRpdXNdLFxuXHRcdFx0XHR2YWx1ZTogYW5nbGVzQXJyW19pXS52YWx1ZSxcblx0XHRcdFx0dGV4dDogYW5nbGVzQXJyW19pXS50ZXh0LFxuXHRcdFx0XHRyYWRpdXM6IGNvbmZpZy5yYWRpdXMgLSBhbmdsZXNBcnJbX2ldLnNSYWRpdXMgKiBjb25maWcuc1JhZGl1cyxcblx0XHRcdFx0c2hvd1Rvb2x0aXA6IGZhbHNlLFxuXHRcdFx0XHRhbmdsZToge1xuXHRcdFx0XHRcdHN0YXJ0OiBhbmdsZXNBcnJbX2ldLmExLFxuXHRcdFx0XHRcdGVuZDogYW5nbGVzQXJyW19pXS5hMlxuXHRcdFx0XHR9LFxuXHRcdFx0XHRzdGFydFBvczoge1xuXHRcdFx0XHRcdHg6IGNvb3Jkcy54MSxcblx0XHRcdFx0XHR5OiBjb29yZHMueTFcblx0XHRcdFx0fSxcblx0XHRcdFx0ZW5kUG9zOiB7XG5cdFx0XHRcdFx0eDogY29vcmRzLngyLFxuXHRcdFx0XHRcdHk6IGNvb3Jkcy55MlxuXHRcdFx0XHR9LFxuXHRcdFx0XHR0ZXh0UG9zaXRpb246IHtcblx0XHRcdFx0XHR4OiB0ZXh0Q3JkWzBdLFxuXHRcdFx0XHRcdHk6IHRleHRDcmRbMV1cblx0XHRcdFx0fVxuXHRcdFx0fTtcblxuXHRcdFx0dGhpcy5wYXRoZXMucHVzaCh0ZW1wbGF0ZSk7XG5cblx0XHRcdHRoaXMucGF0aEFuaW1hdGlvbih0aGlzLnBhdGhlc1tfaV0sIGNvbmZpZywgX2kpO1xuXHRcdH1cblx0fTtcblxuXHQvKipcbiAgKiDQpNGD0L3QutGG0LjRjyDQsNC90LjQvNCw0YbQuNC4XG4gICovXG5cdG5nRGlhZ3JhbW1DdHJsLnByb3RvdHlwZS5wYXRoQW5pbWF0aW9uID0gZnVuY3Rpb24gKHBhdGgsIGNvbmZpZywgaWR4KSB7XG5cdFx0dmFyIF9zZWxmID0gdGhpcztcblx0XHR2YXIgY3VycmVudEFuZ2xlID0gcGF0aC5hbmdsZS5zdGFydDtcblx0XHR2YXIgdGltZVN0ZXAgPSB0aGlzLnBycy5hbmltYXRlVGltZSAvICgocGF0aC5hbmdsZS5lbmQgLSBwYXRoLmFuZ2xlLnN0YXJ0KSAvIHRoaXMucHJzLmFuaW1hdGVTdGVwKTtcblxuXHRcdHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0cGF0aC5zaG93VG9vbHRpcCA9IHBhdGguYW5nbGUuZW5kIC0gcGF0aC5hbmdsZS5zdGFydCA+IDE1O1xuXHRcdH0sIDUwMCk7XG5cblx0XHR2YXIgdGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gZigpIHtcblx0XHRcdGlmIChjdXJyZW50QW5nbGUgPj0gcGF0aC5hbmdsZS5lbmQpIHtcblx0XHRcdFx0Y2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuXHRcdFx0XHRpZiAoX3NlbGYucGF0aExlbmd0aCAtIDEgPT0gaWR4KSBfc2VsZi53YXRjaGVyQWNjZXNzID0gdHJ1ZTtcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fVxuXG5cdFx0XHQvKipcbiAgICAqINCh0LzQtdGJ0LDQtdC8INGB0LXQutGC0L7RgCDQvdCwINC30LDQtNCw0L3Ri9C5INGI0LDQsyDQuCDQv9GA0L7QstC10YDRj9C10LwsINGH0YLQvtCx0Ysg0YPQs9C+0Lsg0L3QtSDQv9GA0LXQstGL0YjQsNC7INC30L3QsNGH0LXQvdC40LUg0YPQs9C70LAg0L/RgNCw0LLQvtCz0L4g0LrRgNCw0Y8g0YHQtdC60YLQvtGA0LBcbiAgICAqL1xuXHRcdFx0Y3VycmVudEFuZ2xlICs9IF9zZWxmLnBycy5hbmltYXRlU3RlcDtcblx0XHRcdGlmIChjdXJyZW50QW5nbGUgPiBwYXRoLmFuZ2xlLmVuZCkgY3VycmVudEFuZ2xlID0gcGF0aC5hbmdsZS5lbmQ7XG5cblx0XHRcdC8qKlxuICAgICog0KHQvNC+0YLRgNC40LwsINC60LDQutGD0Y4g0YfQsNGB0YLRjCDQtNGD0LPQuCDQvtGC0YDQuNGB0L7QstGL0LLQsNGC0YwuINCV0YHQu9C4INC00YPQs9CwINC80LXQvdGM0YjQtSAxODAg0LPRgNCw0LTRg9GB0L7QsiAtINGB0YLQsNCy0LjQvCDRhNC70LDQsyDQvdCwINC+0YLRgNC40YHQvtCy0LrRgyDQvNC10L3RjNGI0LXQuSDRgdGC0L7RgNC+0L3Ri1xuICAgICovXG5cdFx0XHRwYXRoLmZsYWcgPSBjdXJyZW50QW5nbGUgLSBwYXRoLmFuZ2xlLnN0YXJ0IDw9IDE4MCA/IDAgOiAxO1xuXG5cdFx0XHQvKipcbiAgICAqINCi0LXQutGD0YnQsNGPINC60L7QvtGA0LTQuNC90LDRgtCwINGB0LzQtdGJ0LXQvdC40Y8g0LTRg9Cz0LhcbiAgICAqL1xuXHRcdFx0dmFyIGN1cnJlbnRDb29yZHMgPSBfc2VsZi5uZ0RnU2VydmljZS5jYWxjdWxhdGVBYnNDb29yZChjdXJyZW50QW5nbGUsIGNvbmZpZy5jZW50ZXIsIHBhdGgucmFkaXVzKTtcblx0XHRcdHBhdGguc2V0dGluZ3MgPSAnTSAnICsgY29uZmlnLmNlbnRlci54ICsgJywnICsgY29uZmlnLmNlbnRlci55ICsgJyBMICcgKyAnJyArIHBhdGguc3RhcnRQb3MueCArICcsJyArIHBhdGguc3RhcnRQb3MueSArICcgQScgKyAnJyArIHBhdGgucmFkaXVzICsgJywnICsgcGF0aC5yYWRpdXMgKyAnIDAgJyArICcnICsgcGF0aC5mbGFnICsgJywgMSAnICsgY3VycmVudENvb3Jkc1swXSArICcsJyArIGN1cnJlbnRDb29yZHNbMV0gKyAnJztcblxuXHRcdFx0LyoqXG4gICAgKiDQoNC10LrRg9GA0YHQuNC8INGC0LDQudC80LDRg9GCXG4gICAgKi9cblx0XHRcdHRpbWVvdXQgPSBzZXRUaW1lb3V0KGYsIHRpbWVTdGVwKTtcblxuXHRcdFx0LyoqXG4gICAgKiDQntCx0L3QvtCy0LvRj9C10Lwg0LLRjNGO0YXRg1xuICAgICovXG5cdFx0XHRfc2VsZi4kc2NvcGUuJGRpZ2VzdCgpO1xuXHRcdH0sIHRpbWVTdGVwKTtcblx0fTtcblxuXHQvKipcbiAgKiDQmtC+0LvQu9Cx0LXQuiDQutC70LjQutCwXG4gICovXG5cdG5nRGlhZ3JhbW1DdHJsLnByb3RvdHlwZS5wYXRoQ2xpY2sgPSBmdW5jdGlvbiAoZSwgaXRlbSkge1xuXHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHR0aGlzLnBhdGhDbGlja0NiLmNhbGwodGhpcy5jdHgsIGl0ZW0pO1xuXHR9O1xufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblx0YW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZSgnbmdSJywgZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiBmdW5jdGlvbiAoc2NvcGUsIGVsZW0sIGF0dHJzKSB7XG5cdFx0XHRhdHRycy4kb2JzZXJ2ZSgnbmdSJywgZnVuY3Rpb24gKHIpIHtcblx0XHRcdFx0ZWxlbS5hdHRyKCdyJywgcik7XG5cdFx0XHR9KTtcblx0XHR9O1xuXHR9KS5kaXJlY3RpdmUoJ25nQ3gnLCBmdW5jdGlvbiAoKSB7XG5cdFx0cmV0dXJuIGZ1bmN0aW9uIChzY29wZSwgZWxlbSwgYXR0cnMpIHtcblx0XHRcdGF0dHJzLiRvYnNlcnZlKCduZ0N4JywgZnVuY3Rpb24gKGN4KSB7XG5cdFx0XHRcdGVsZW0uYXR0cignY3gnLCBjeCk7XG5cdFx0XHR9KTtcblx0XHR9O1xuXHR9KS5kaXJlY3RpdmUoJ25nWCcsIGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gZnVuY3Rpb24gKHNjb3BlLCBlbGVtLCBhdHRycykge1xuXHRcdFx0YXR0cnMuJG9ic2VydmUoJ25nWCcsIGZ1bmN0aW9uICh4KSB7XG5cdFx0XHRcdGVsZW0uYXR0cigneCcsIHgpO1xuXHRcdFx0fSk7XG5cdFx0fTtcblx0fSkuZGlyZWN0aXZlKCduZ1knLCBmdW5jdGlvbiAoKSB7XG5cdFx0cmV0dXJuIGZ1bmN0aW9uIChzY29wZSwgZWxlbSwgYXR0cnMpIHtcblx0XHRcdGF0dHJzLiRvYnNlcnZlKCduZ1knLCBmdW5jdGlvbiAoeSkge1xuXHRcdFx0XHRlbGVtLmF0dHIoJ3knLCB5KTtcblx0XHRcdH0pO1xuXHRcdH07XG5cdH0pLmRpcmVjdGl2ZSgnbmdDeScsIGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gZnVuY3Rpb24gKHNjb3BlLCBlbGVtLCBhdHRycykge1xuXHRcdFx0YXR0cnMuJG9ic2VydmUoJ25nQ3knLCBmdW5jdGlvbiAoY3kpIHtcblx0XHRcdFx0ZWxlbS5hdHRyKCdjeScsIGN5KTtcblx0XHRcdH0pO1xuXHRcdH07XG5cdH0pLmRpcmVjdGl2ZSgnbmdEJywgZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiBmdW5jdGlvbiAoc2NvcGUsIGVsZW0sIGF0dHJzKSB7XG5cdFx0XHRhdHRycy4kb2JzZXJ2ZSgnbmdEJywgZnVuY3Rpb24gKGQpIHtcblx0XHRcdFx0ZWxlbS5hdHRyKCdkJywgZCk7XG5cdFx0XHR9KTtcblx0XHR9O1xuXHR9KS5kaXJlY3RpdmUoJ25nRmlsbCcsIGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gZnVuY3Rpb24gKHNjb3BlLCBlbGVtLCBhdHRycykge1xuXHRcdFx0YXR0cnMuJG9ic2VydmUoJ25nRmlsbCcsIGZ1bmN0aW9uIChmaWxsKSB7XG5cdFx0XHRcdGVsZW0uYXR0cignZmlsbCcsIGZpbGwpO1xuXHRcdFx0fSk7XG5cdFx0fTtcblx0fSk7XG59KSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
